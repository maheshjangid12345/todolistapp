{% extends "base.html" %}

{% block title %}Change Password - Professional TODO App{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-key me-2"></i>Change Password
                </h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('auth.change_password') }}" id="changePasswordForm">
                    <div class="mb-3">
                        <label for="current_password" class="form-label">
                            <i class="fas fa-lock me-1"></i>Current Password
                        </label>
                        <input type="password" class="form-control" id="current_password" 
                               name="current_password" required>
                        <div class="form-text">Enter your current password to verify your identity.</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="new_password" class="form-label">
                            <i class="fas fa-lock me-1"></i>New Password
                        </label>
                        <input type="password" class="form-control" id="new_password" 
                               name="new_password" required minlength="8">
                        <div class="form-text">
                            Password must be at least 8 characters long and contain:
                            <ul class="mt-1 mb-0">
                                <li>At least one uppercase letter</li>
                                <li>At least one lowercase letter</li>
                                <li>At least one number</li>
                                <li>At least one special character</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">
                            <i class="fas fa-lock me-1"></i>Confirm New Password
                        </label>
                        <input type="password" class="form-control" id="confirm_password" 
                               name="confirm_password" required minlength="8">
                        <div class="form-text">Please confirm your new password.</div>
                    </div>
                    
                    <!-- Password Strength Indicator -->
                    <div class="mb-3">
                        <label class="form-label">Password Strength</label>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar" id="passwordStrength" role="progressbar" 
                                 style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small class="text-muted" id="strengthText">Enter a password to see strength</small>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Change Password
                        </button>
                        <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Profile
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Password Security Tips -->
        <div class="card shadow mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-shield-alt me-2"></i>Password Security Tips
                </h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Use a unique password for each account
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Avoid common words and personal information
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Consider using a password manager
                    </li>
                    <li class="mb-0">
                        <i class="fas fa-check text-success me-2"></i>
                        Change passwords regularly
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPassword = document.getElementById('new_password');
    const confirmPassword = document.getElementById('confirm_password');
    const passwordStrength = document.getElementById('passwordStrength');
    const strengthText = document.getElementById('strengthText');
    
    // Password strength checker
    newPassword.addEventListener('input', function() {
        const password = this.value;
        const strength = calculatePasswordStrength(password);
        updatePasswordStrengthIndicator(strength);
    });
    
    // Password confirmation checker
    confirmPassword.addEventListener('input', function() {
        validatePasswordConfirmation();
    });
    
    // Form validation
    document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
        if (!validatePasswordConfirmation()) {
            e.preventDefault();
            alert('Passwords do not match!');
            return false;
        }
        
        if (!validatePasswordStrength()) {
            e.preventDefault();
            alert('Please choose a stronger password!');
            return false;
        }
    });
    
    function calculatePasswordStrength(password) {
        let score = 0;
        
        if (password.length >= 8) score += 20;
        if (password.length >= 12) score += 10;
        if (/[a-z]/.test(password)) score += 20;
        if (/[A-Z]/.test(password)) score += 20;
        if (/[0-9]/.test(password)) score += 20;
        if (/[^A-Za-z0-9]/.test(password)) score += 10;
        
        return Math.min(score, 100);
    }
    
    function updatePasswordStrengthIndicator(strength) {
        passwordStrength.style.width = strength + '%';
        passwordStrength.setAttribute('aria-valuenow', strength);
        
        if (strength < 40) {
            passwordStrength.className = 'progress-bar bg-danger';
            strengthText.textContent = 'Weak password';
            strengthText.className = 'text-danger';
        } else if (strength < 70) {
            passwordStrength.className = 'progress-bar bg-warning';
            strengthText.textContent = 'Fair password';
            strengthText.className = 'text-warning';
        } else if (strength < 90) {
            passwordStrength.className = 'progress-bar bg-info';
            strengthText.textContent = 'Good password';
            strengthText.className = 'text-info';
        } else {
            passwordStrength.className = 'progress-bar bg-success';
            strengthText.textContent = 'Strong password';
            strengthText.className = 'text-success';
        }
    }
    
    function validatePasswordConfirmation() {
        const password = newPassword.value;
        const confirm = confirmPassword.value;
        
        if (confirm && password !== confirm) {
            confirmPassword.setCustomValidity("Passwords don't match");
            return false;
        } else {
            confirmPassword.setCustomValidity('');
            return true;
        }
    }
    
    function validatePasswordStrength() {
        const password = newPassword.value;
        const strength = calculatePasswordStrength(password);
        return strength >= 60; // Require at least "Good" strength
    }
});
</script>
{% endblock %}
